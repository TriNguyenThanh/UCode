<Window x:Class="UCode.Desktop.Views.CreateAssignmentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Tạo bài tập mới - UCode" 
        Height="700" Width="900"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Grid>
        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay" Background="#80000000" 
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}" 
              Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Foreground="#FACB01"/>
                <TextBlock Text="Đang tải dữ liệu..." Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,15,0,0" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="40">
                <!-- Header -->
                <TextBlock Text="Tạo bài tập mới" FontSize="28" FontWeight="Bold" Foreground="#191970" Margin="0,0,0,5"/>
                <TextBlock FontSize="14" Foreground="#666" Margin="0,0,0,30">
                    <Run Text="Lớp: "/>
                    <Run Text="{Binding ClassData.ClassName}" FontWeight="SemiBold"/>
                    <Run Text=" ("/>
                    <Run Text="{Binding ClassData.ClassCode}"/>
                    <Run Text=")"/>
                </TextBlock>

                <!-- Form -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <!-- Assignment Type -->
                        <TextBlock Text="Loại bài tập *" FontSize="14" FontWeight="SemiBold" Foreground="#191970" Margin="0,0,0,5"/>
                        <ComboBox ItemsSource="{Binding AssignmentTypes}"
                                  SelectedItem="{Binding AssignmentType}"
                                  Height="40" FontSize="14" Margin="0,0,0,20">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource AssignmentTypeDisplayConverter}}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <!-- Title -->
                        <TextBlock Text="Tên bài tập *" FontSize="14" FontWeight="SemiBold" Foreground="#191970" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}"
                                 Height="40" FontSize="14" Padding="10" Margin="0,0,0,20"/>

                        <!-- Description -->
                        <TextBlock Text="Mô tả" FontSize="14" FontWeight="SemiBold" Foreground="#191970" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                                 Height="120" FontSize="14" Padding="10" TextWrapping="Wrap"
                                 AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Margin="0,0,0,20"/>

                        <!-- Start Time -->
                        <TextBlock Text="Thời gian bắt đầu *" FontSize="14" FontWeight="SemiBold" Foreground="#191970" Margin="0,0,0,5"/>
                        <DatePicker SelectedDate="{Binding StartTime}"
                                    Height="40" FontSize="14" Margin="0,0,0,20"/>

                        <!-- No End Date -->
                        <CheckBox IsChecked="{Binding NoEndDate}"
                                  Content="Không có thời gian kết thúc"
                                  FontSize="14" Foreground="#191970" FontWeight="SemiBold" Margin="0,0,0,15"/>

                        <!-- End Time -->
                        <TextBlock Text="Thời gian kết thúc" FontSize="14" FontWeight="SemiBold" Foreground="#191970" Margin="0,0,0,5"
                                   Visibility="{Binding IsEndDateEnabled, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <DatePicker SelectedDate="{Binding EndTime}"
                                    Height="40" FontSize="14" Margin="0,0,0,20"
                                    IsEnabled="{Binding IsEndDateEnabled}"
                                    Visibility="{Binding IsEndDateEnabled, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                        <!-- Allow Late Submission -->
                        <CheckBox IsChecked="{Binding AllowLateSubmission}"
                                  Content="Cho phép nộp bài muộn"
                                  FontSize="14" Foreground="#191970" FontWeight="SemiBold" Margin="0,0,0,20"/>

                        <!-- Info Alert -->
                        <Border Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="1" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ℹ" Foreground="#2196F3" FontSize="20" Margin="0,0,10,0" VerticalAlignment="Top"/>
                                <TextBlock TextWrapping="Wrap" Foreground="#1976D2" FontSize="13">
                                    Sau khi tạo bài tập, bạn sẽ được chuyển đến trang quản lý bài tập để thêm các bài toán.
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Actions -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Hủy" Style="{StaticResource SecondaryButtonStyle}"
                                    Command="{Binding CancelCommand}"
                                    Width="120" Margin="0,0,15,0"/>
                            <Button Content="{Binding IsSaving, Converter={StaticResource SavingTextConverter}}"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    Command="{Binding SaveCommand}"
                                    IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBooleanConverter}}"
                                    Width="120"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Saving Overlay -->
        <Grid Background="#80000000" 
              Visibility="{Binding IsSaving, Converter={StaticResource BooleanToVisibilityConverter}}" 
              Panel.ZIndex="999">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Foreground="#FACB01"/>
                <TextBlock Text="Đang tạo..." Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,15,0,0" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>

